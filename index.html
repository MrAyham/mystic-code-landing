<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ุดููุฑุฉ ุงูุบููุถ โ Mystic Code Experience</title>
  <meta name="description" content="ุงููุฑุญูุฉ ุงูุฃููู: ุจูุงุจุฉ ุงูุชุดููุด. ุงุฎุชุฑ ูุณุงุฑู ูุฃุฏุฎู ุนุงูู ุดููุฑุฉ ุงูุบููุถ." />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <canvas id="matrix"></canvas>

  <div class="content">
    <img src="assets/mystic-symbol-green.png" alt="ุฑูุฒ ุดููุฑุฉ ุงูุบููุถ" class="symbol" />

    <h1 class="title">ููุฏ ุฑุตุฏุชูโฆ ููุงู ุณุฑ ูููุณ ุจุงุณูู</h1>
    <p class="subtitle">ุฃุฏุฎู ุงุณูู ูุฏุน ููุจ ุงูุจูุงุจุฉ ููุชุญ ููโฆ</p>

    <form id="entryForm" novalidate>
      <div class="fields">
        <input type="text" id="name" name="name" placeholder="ุงุณูู" required />
        <input type="email" id="email" name="email" placeholder="ุจุฑูุฏู ุงูุฅููุชุฑููู" required />
      </div>

      <div class="buttons">
        <button type="button" id="pathA" class="btn btn-a">๐ฎ ุงุฎุชุฑ ุงููุณุงุฑ ุงูุณุงุญุฑ</button>
        <button type="button" id="pathB" class="btn btn-b">โก ุงุฎุชุฑ ุงููุณุงุฑ ุงูุบุงูุถ</button>
      </div>
      <p class="note">ุจุงูููุฑ ุนูู ุฃุญุฏ ุงููุณุงุฑููุ ุณูุณุฌู ุจุฑูุฏู ููููุฏู ูููุฑุญูุฉ ุงูุจููุณุฌูุฉ.</p>
      <p id="status" class="status"></p>
    </form>
  </div>

  <script src="matrix.js"></script>
  <script>
    function validate() {
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      if (!name || !email) { setStatus('ุฑุฌุงุกู ุฃุฏุฎู ุงูุงุณู ูุงูุจุฑูุฏ.', true); return null; }
      if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { setStatus('ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุบูุฑ ุตุงูุญ.', true); return null; }
      return { name, email };
    }

    function setStatus(msg, isError=false) {
      const el = document.getElementById('status');
      el.textContent = msg;
      el.style.color = isError ? '#ff6b6b' : '#00ff88';
    }

    async function subscribe(path) {
      const data = validate(); if (!data) return;
      localStorage.setItem('mystic_name', data.name);
      localStorage.setItem('mystic_email', data.email);
      localStorage.setItem('mystic_path', path);

      setStatus('ุฌุงุฑู ุชุณุฌูู ุจุฑูุฏูโฆ');
      try {
        const res = await fetch('/api/subscribe', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name: data.name, email: data.email, path })
        });
        if (!res.ok) throw new Error('Subscription failed');
      } catch (e) {
        // ุญุชู ูู ูุดู ุงูุงุดุชุฑุงูุ ูููู ุงูุฑุญูุฉ (Fail-open)
        console.warn('Subscription API failed:', e);
      }
      // ุงูุงูุชูุงู ุฅูู ุงููุฑุญูุฉ ุงูุชุงููุฉ
      window.location.href = 'stage2.html';
    }

    document.getElementById('pathA').addEventListener('click', () => subscribe('A'));
    document.getElementById('pathB').addEventListener('click', () => subscribe('B'));

    window.addEventListener('resize', () => {
      const c = document.getElementById('matrix');
      c.height = window.innerHeight;
      c.width = window.innerWidth;
    });
  </script>
</body>
</html>
