<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>المرحلة الثانية – شيفرة الغموض</title>
  <link rel="stylesheet" href="stage2.css" />

  <!-- PayPal Hosted Buttons (Part 1) — لا تضيفها أكثر من مرة في الصفحة -->
  <script 
    src="https://www.paypal.com/sdk/js?client-id=BAA1hgZV6lN0aY_t77gpDPg7-3MWzCfoL2BYumMzIYRozsEqeiwOpP8SU-p7s1LiWVC6bqyZM0A7zLewWU&components=hosted-buttons&disable-funding=venmo&currency=USD">
  </script>

  <!-- تلميح SEO بسيط -->
  <meta name="description" content="المرحلة الثانية من شيفرة الغموض: افتح البوابة البنفسجية وأكمل الرحلة." />
</head>
<body>
  <!-- خلفية بنفسجية -->
  <div class="bg"></div>

  <div class="content">
    <h1 id="title">المرحلة الثانية</h1>
    <p id="intro">الوعي يتشكّل… بياناتك تُضاء طبقةً طبقة.</p>

    <div class="card">
      <!-- نص شخصي حسب المسار -->
      <p id="pathText" style="margin-top:4px;"></p>

      <p style="margin-top:8px;">لفك الشيفرة التالية، افتح البوابة المدفوعة:</p>

      <!-- PayPal Hosted Button (Part 2) -->
      <div id="paypal-container-ZUXNK5M7LZPNA" style="margin-top: 12px;"></div>

      <p class="hint">
        بعد الدفع سيتم إعادتك تلقائيًا إلى المرحلة التالية.
      </p>

      <!-- رابط بديل (Fallback) في حال تأخر التحويل -->
      <a id="fallbackLink" class="btn" href="stage3.html?paid=1" style="display:none;margin-top:10px;">
        الذهاب يدويًا إلى المرحلة الثالثة
      </a>
    </div>
  </div>

  <script>
    // تخصيص النص حسب المسار والاسم
    const path = localStorage.getItem('mystic_path') || 'A';
    const name = localStorage.getItem('mystic_name') || 'أنت';
    const pathText = document.getElementById('pathText');
    pathText.textContent = (path === 'A')
      ? `${name}… الحبر بدأ يرسم صورتك في مملكتي.`
      : `${name}… البيانات تتشابك، اقترابٌ من النواة.`;

    // زر PayPal المستضاف (نفس الـ hostedButtonId الذي زوّدتني به)
    paypal.HostedButtons({
      hostedButtonId: "ZUXNK5M7LZPNA",
    }).render("#paypal-container-ZUXNK5M7LZPNA");

    // إظهار رابط بديل بعد مدة قصيرة، فقط كخطة B لو تأخر التحويل
    setTimeout(() => {
      document.getElementById('fallbackLink').style.display = 'inline-block';
    }, 12000);
  </script>
</body>
</html>
