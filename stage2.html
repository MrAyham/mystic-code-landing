<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>المرحلة الثانية – شيفرة الغموض</title>
  <link rel="stylesheet" href="stage2.css" />
</head>
<body>
  <div class="bg"></div>
  <div class="content">
    <h1 id="title">المرحلة الثانية</h1>
    <p id="intro">الوعي يتشكّل… بياناتك تُضاء طبقةً طبقة.</p>

    <div class="card">
      <p id="pathText"></p>
      <p>لفك الشيفرة التالية، افتح البوابة المدفوعة:</p>
      <a id="unlock" class="btn">Unlock the Next Cipher</a>
      <p class="hint">بعد الدفع، سنقودك تلقائيًا للمرحلة الثالثة.</p>
    </div>
  </div>

  <script>
    // Personalize by path
    const path = localStorage.getItem('mystic_path') || 'A';
    const name = localStorage.getItem('mystic_name') || 'أنت';
    const pathText = document.getElementById('pathText');
    if (path === 'A') {
      pathText.textContent = `${name}… الحبر بدأ يرسم صورتك في مملكتي.`;
    } else {
      pathText.textContent = `${name}… البيانات تتشابك، اقترابٌ من النواة.`;
    }

    // Payment link handling
    // استخدم رابط Stripe Payment Link الجاهز وضعه كقيمة للمتغير التالي:
    const STRIPE_PAYMENT_LINK = typeof window !== 'undefined' ? window.STRIPE_PAYMENT_LINK : null;

    // بديل: اسحب من وسم meta يوضع في رأس الصفحة عبر Vercel env replace
    const meta = document.querySelector('meta[name="payment-link"]');
    const paymentFromMeta = meta ? meta.getAttribute('content') : '';

    const paymentUrl = paymentFromMeta || STRIPE_PAYMENT_LINK || '#';

    const unlock = document.getElementById('unlock');
    unlock.href = paymentUrl;
    unlock.addEventListener('click', (e) => {
      if (paymentUrl === '#') {
        e.preventDefault();
        alert('أضف رابط الدفع (Stripe Payment Link) في الإعدادات ثم أعد المحاولة.');
      } else {
        // يمكننا إضافة باراميتر للعودة لاحقًا مثل ?paid=1
        // Stripe Payment Links يسمح بإضافة redirect في لوحة Stripe (Success URL).
      }
    });
  </script>
</body>
</html>
