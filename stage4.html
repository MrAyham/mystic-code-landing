<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" /><meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Stage 4 · نار التحوّل</title>
<style>
  html,body{margin:0;height:100%;background:#000;color:#fff;font-family:sans-serif;overflow:hidden}
  #matrix{position:fixed;inset:0;z-index:-2;background:#000;pointer-events:none}
  .wrap{min-height:100vh;display:grid;place-items:center;padding:20px}
  .card{width:min(860px,94vw);text-align:center;background:rgba(255,255,255,.05);
        border:1px solid rgba(255,255,255,.12);border-radius:18px;padding:22px;backdrop-filter:blur(6px)}
  textarea{width:min(560px,94%);height:90px;padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,.2);background:#12070a;color:#fff}
  .btn{display:inline-block;margin-top:10px;padding:10px 16px;border-radius:999px;border:0;background:linear-gradient(90deg,#ef4444,#f59e0b);color:#210}
</style>
</head>
<body data-matrix-color="#ff4d4d">
<canvas id="matrix"></canvas>
<div class="wrap"><div class="card">
  <h1>المرحلة الرابعة – نار التحوّل</h1>
  <p>اكتب/ي جملة من <b>7 كلمات</b>. سنأخذ علامة منها إلى كلمة التتويج.</p>
  <textarea id="oath" placeholder="اكتب/ي جملتك هنا…"></textarea><br/>
  <button class="btn" onclick="save()">ثبت القسم</button>
  <p id="status"></p>
  <div id="ok" style="display:none;margin-top:10px">
    <a class="btn" href="stage5.html">إلى التتويج</a>
  </div>
</div></div>

<script>
function save(){
  const txt=(document.getElementById('oath').value||'').trim();
  const s=document.getElementById('status');
  const words=txt.split(/\s+/).filter(Boolean);
  if(words.length!==7){ s.textContent='نحتاج سبع كلمات تمامًا.'; s.style.color='#ff6b6b'; return; }
  const pick=(words[3]||'')[2]||''; // الحرف الثالث من الكلمة الرابعة
  localStorage.setItem('mc_oath',txt);
  localStorage.setItem('mc_f2',(pick||'').toUpperCase());
  s.textContent='تم التثبيت. العلامة محفوظة.'; s.style.color='#00ff88';
  document.getElementById('ok').style.display='block';
}
</script>
<script>
(function(){const c=document.getElementById('matrix'),x=c.getContext('2d');
function r(){c.width=innerWidth;c.height=innerHeight}addEventListener('resize',r);r();
const color=document.body.getAttribute('data-matrix-color')||'#f44',fs=16,chars='ｱｶｻﾀﾅﾊﾏﾔﾗﾜ0123456789';
let cols=Math.floor(c.width/fs),drops=Array(cols).fill(1);
function d(){x.fillStyle='rgba(0,0,0,0.08)';x.fillRect(0,0,c.width,c.height);
x.fillStyle=color;x.font=fs+'px monospace';for(let i=0;i<drops.length;i++){const t=chars[Math.random()*chars.length|0];
x.fillText(t,i*fs,drops[i]*fs);if(drops[i]*fs>c.height&&Math.random()>0.975)drops[i]=0;drops[i]++;}}
(function l(){d();requestAnimationFrame(l)})()})();
</script>
</body></html>
